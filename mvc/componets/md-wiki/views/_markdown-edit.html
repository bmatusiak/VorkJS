<%- vork.load.element("sidemenu") %>


<link rel="stylesheet" href="/css/googlecode.css">
<script src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


<script src="/ace/src/ace.js" type="text/javascript" charset="utf-8"></script>
<script src="/ace/src/theme-textmate.js" type="text/javascript" charset="utf-8"></script>
<script src="/ace/src/mode-markdown.js" type="text/javascript" charset="utf-8"></script>

<style type="text/css">
#editor {
width: 800px;
height: 490px;
background: white; 
}
</style>
<% vork.controler.toolbar = '<input type="submit" value="Edit" onClick="javascript: edit();" />' %>

<div id="markdownView"><%- vork.globals.md(vork.controler.markdown_string) %></div>
<% if(vork.controler.markdown_authorID){ %>
<div class="vorkwiki_lastmod"><a href="http://www.facebook.com/profile.php?id=<%= vork.controler.markdown_authorID  %>" title="" onclick="window.open(this.href); return false;"><img src="//graph.facebook.com/<%= vork.controler.markdown_authorID  %>/picture?type=square" width="25" height="25" alt="<%= vork.controler.markdown_authorName  %>" /></a>Last modified  by <a href="http://www.facebook.com/profile.php?id=<%= vork.controler.markdown_authorID  %>" title="<%= vork.controler.markdown_authorName  %>" onclick="window.open(this.href); return false;"><%= vork.controler.markdown_authorName  %></a></div>
<% } %>

<div id="dialog" title="Markdown Page Editor">
    <div id="editor"><%= vork.controler.markdown_string %></div>
</div>
        
<script>
$(function(){
    var editor = ace.edit("editor");
        editor.setTheme("ace/theme/textmate");
       editor.setShowPrintMargin(false);
    var MarkdownMode = require("ace/mode/markdown").Mode;
        editor.getSession().setMode(new MarkdownMode());
    
    //buttons
    $( "input:submit, button").button();
    // Dialog
    $('#dialog').dialog({
    	autoOpen: false,
    	width: 825,
        height:600,
        resizable: false,
    	buttons: {
    		"Save": function() {
                var self = $(this);
                var success = function(error){
                    self.dialog("close"); 
                    javascript: window.location = "/<%- vork.controler.pathToElement %>";
                }
                $.ajax({
                  type: 'POST',
                  url: "/api/post",
                  success: success,
                  data: {"content": editor.getSession().getDocument().getValue(),pathToElement:"<%- vork.controler.pathToElement %>"}
                });
                //$(this).dialog("close");
                
    		},
    		"Cancel": function() {
                $(this).dialog("close");
    		}
    	}
    });
});
function edit(){
    
    editor = ace.edit("editor");
        editor.setTheme("ace/theme/textmate");
       editor.setShowPrintMargin(false);
    var MarkdownMode = require("ace/mode/markdown").Mode;
        editor.getSession().setMode(new MarkdownMode());
        
        $( "#dialog" ).dialog( "open" );
}
</script>