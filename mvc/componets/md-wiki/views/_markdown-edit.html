<%- load.element("sidemenu") %>

<script src="/ace/src/ace.js" type="text/javascript" charset="utf-8"></script>
<script src="/ace/src/theme-textmate.js" type="text/javascript" charset="utf-8"></script>
<script src="/ace/src/mode-markdown.js" type="text/javascript" charset="utf-8"></script>

<style type="text/css">
#editor {
width: 800px;
height: 490px;
background: white; 
}
</style>
<% controler.toolbar = '<input type="submit" value="Edit" onClick="javascript: edit();" />' %>

<div id="markdownView"><%- globals.md(controler.markdown_string) %></div>
<% if(controler.markdown_authorID){ %>
<div class="vorkwiki_lastmod"><a href="http://www.facebook.com/profile.php?id=<%= controler.markdown_authorID  %>" title="" onclick="window.open(this.href); return false;"><img src="//graph.facebook.com/<%= controler.markdown_authorID  %>/picture?type=square" width="25" height="25" alt="<%= controler.markdown_authorName  %>" /></a>Last modified  by <a href="http://www.facebook.com/profile.php?id=<%= controler.markdown_authorID  %>" title="<%= controler.markdown_authorName  %>" onclick="window.open(this.href); return false;"><%= controler.markdown_authorName  %></a></div>
<% } %>

<div id="dialog" title="Markdown Page Editor">
    <div id="editor"><%= controler.markdown_string %></div>
</div>
        
<script>
var editor = {}
//buttons
$( "input:submit, button").button();
// Dialog
$('#dialog').dialog({
	autoOpen: false,
	width: 825,
    height:600,
    resizable: false,
	buttons: {
		"Save": function() {
            var self = $(this);
            var success = function(error){
                self.dialog("close"); 
            }
            $.ajax({
              type: 'POST',
              url: "/api/post",
              success: success,
              data: {"content": editor.getSession().getDocument().getValue(),pathToElement:"<%- controler.pathToElement %>"}
            });
            //$(this).dialog("close");
            
		},
		"Cancel": function() {
            var out = editor.getSession().getDocument().getValue();
            $(this).text(out);
			//$(this).dialog("close");
		}
	}
});
function edit(){
    
    editor = ace.edit("editor");
        editor.setTheme("ace/theme/textmate");
       editor.setShowPrintMargin(false);
    var MarkdownMode = require("ace/mode/markdown").Mode;
        editor.getSession().setMode(new MarkdownMode());
        
        $( "#dialog" ).dialog( "open" );
}
</script>